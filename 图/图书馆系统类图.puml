@startuml 图书馆管理系统类图

' 样式设置
skinparam classAttributeIconSize 0
skinparam class {
    BackgroundColor<<实体>> LightBlue
    BackgroundColor<<服务>> LightGreen
    BackgroundColor<<状态>> LightYellow
    BackgroundColor<<组件>> LightPink
    BorderColor Black
    ArrowColor Black
}

title 图书馆管理系统 - 类图\n(基于 LocalStorage 的纯前端架构)

' ==================== 核心实体类 ====================
package "核心实体类" <<Rectangle>> {
    
    class 用户 <<实体>> {
        - 用户ID: string
        - 用户名: string
        - 密码: string
        - 姓名: string
        - 邮箱: string
        - 电话: string
        - 注册日期: string
        - 最后登录时间: string
        - 角色: '读者' | '管理员' | '超级管理员'
    }
    
    class 读者 <<实体>> {
        - 读者ID: string
        - 用户ID: string
        - 借阅上限: number
        - 已借数量: number
        - 会员等级: string
        - 信用分数: number
        - 待缴罚款: number
    }
    
    class 管理员 <<实体>> {
        - 管理员ID: string
        - 用户ID: string
        - 管理员角色: string
        - 部门: string
    }
    
    class 出版物 <<实体>> {
        - 出版物ID: string
        - 标题: string
        - 作者: string
        - 出版社: string
        - 出版日期: string
        - 状态: string
        - 借阅期限: number
        - 位置: string
        - 总数量: number
        - 可借数量: number
        - 平均评分: number
        - 评分总数: number
        - 分类ID: string
        - 类型: string
    }
    
    class 书籍 <<实体>> {
        - ISBN: string
        - 分类: string
        - 页数: number
        - 语言: string
        - 版本: string
    }
    
    class 期刊 <<实体>> {
        - ISSN: string
        - 期号: string
        - 卷号: string
    }
    
    class 电子书 <<实体>> {
        - 文件格式: string
        - 文件大小: number
        - 下载链接: string
        - 下载次数: number
        - 同时在线用户数: number
    }
    
    class 借阅记录 <<实体>> {
        - 记录ID: string
        - 读者ID: string
        - 出版物ID: string
        - 借阅日期: string
        - 应还日期: string
        - 归还日期: string | null
        - 状态: string
        - 续借次数: number
        - 最大续借次数: number
    }
    
    class 预约记录 <<实体>> {
        - 预约ID: string
        - 读者ID: string
        - 出版物ID: string
        - 预约日期: string
        - 过期日期: string
        - 状态: string
        - 优先级: number
    }
    
    class 罚款记录 <<实体>> {
        - 罚款ID: string
        - 读者ID: string
        - 借阅记录ID: string
        - 金额: number
        - 原因: string
        - 开具日期: string
        - 支付日期: string | null
        - 状态: string
    }
    
    class 通知 <<实体>> {
        - 通知ID: string
        - 用户ID: string
        - 类型: string
        - 标题: string
        - 内容: string
        - 发送日期: string
        - 是否已读: boolean
    }
    
    class 分类 <<实体>> {
        - 分类ID: string
        - 分类名称: string
        - 父分类ID: string | null
        - 描述: string
    }
}

' ==================== 业务服务层 ====================
package "业务服务层" <<Rectangle>> {
    
    class 认证服务 <<服务>> {
        + 登录(凭据): Promise<响应>
        + 登出(): void
        + 获取当前用户(): 用户 | null
        + 获取令牌(): string | null
        + 是否已认证(): boolean
        + 检查角色(角色): boolean
        + 修改密码(用户ID, 旧密码, 新密码): Promise<响应>
        + 注册读者(数据): Promise<响应>
    }
    
    class 存储服务 <<服务>> {
        + 获取<T>(键): T | null
        + 设置<T>(键, 值): void
        + 删除(键): void
        + 清空(): void
        + 获取所有键(): string[]
    }
    
    class 数据库服务 <<服务>> {
        + 初始化(): void
        + 初始化默认数据(): void
        + 获取全部<T>(表): T[]
        + 根据ID获取<T>(表, ID字段, ID): T | null
        + 插入<T>(表, 记录): T
        + 更新<T>(表, ID字段, ID, 更新): T | null
        + 删除<T>(表, ID字段, ID): boolean
        + 查询<T>(表, 条件): T[]
        + 清空表(表): void
        + 清空全部(): void
        + 导出数据(): string
        + 导入数据(JSON数据): boolean
    }
    
    class 加密工具 <<服务>> {
        + 哈希密码(密码): Promise<string>
        + 验证密码(密码, 哈希): Promise<boolean>
        + 生成ID(前缀): string
        + 生成令牌(载荷): string
        + 解析令牌(令牌): any
        + 令牌是否过期(令牌): boolean
    }
}

' ==================== 状态管理 ====================
package "状态管理 (Pinia)" <<Rectangle>> {
    
    class 认证状态 <<状态>> {
        - 用户: 用户 | null
        - 令牌: string | null
        + 是否已认证: boolean
        + 是否读者: boolean
        + 是否管理员: boolean
        + 是否超级管理员: boolean
        + 登录(凭据): Promise<响应>
        + 登出(): void
        + 修改密码(旧密码, 新密码): Promise<响应>
        + 检查角色(角色): boolean
    }
}

' ==================== 管理员界面组件 ====================
package "管理员界面组件" <<Rectangle>> {
    
    class 管理员控制面板 <<组件>> {
        - 当前菜单: string
        - 统计数据: 统计信息
        + 处理菜单选择(索引): void
        + 处理登出(): void
        + 处理导出数据(): void
        + 处理清空数据(): void
        --
        功能：
        - 数据概览
        - 统计信息展示
        - 快速操作入口
        - 超级管理员工具
    }
    
    class 出版物管理 <<组件>> {
        - 出版物列表: 出版物[]
        - 搜索表单: 搜索表单
        - 编辑表单: 出版物表单
        + 加载出版物(): void
        + 处理搜索(): void
        + 处理编辑(行): void
        + 处理删除(行): void
        + 处理提交(): void
        --
        功能：
        - 添加图书/期刊/电子书
        - 编辑出版物信息
        - 删除出版物
        - 搜索和筛选
    }
    
    class 读者管理 <<组件>> {
        - 读者列表: (读者 & 用户)[]
        - 当前读者: 读者 | null
        + 加载读者(): void
        + 处理查看详情(行): void
        + 处理编辑(行): void
        + 处理提交编辑(): void
        --
        功能：
        - 查看所有读者
        - 查看读者详情
        - 查看借阅历史
        - 编辑读者信息
    }
    
    class 借阅管理 <<组件>> {
        - 借阅记录: 借阅记录[]
        - 统计数据: 借阅统计
        + 加载借阅记录(): void
        + 处理提交借阅(): void
        + 处理归还(行): void
        + 处理续借(行): void
        --
        功能：
        - 办理借阅
        - 办理归还
        - 续借处理
        - 自动逾期检测
        - 自动生成罚款
    }
    
    class 预约管理 <<组件>> {
        - 预约记录: 预约记录[]
        - 统计数据: 预约统计
        + 加载预约记录(): void
        + 处理通知(行): void
        + 处理取消(行): void
        + 处理借阅(行): void
        --
        功能：
        - 查看所有预约
        - 通知读者可借
        - 取消预约
        - 直接办理借阅
    }
}

' ==================== 读者界面组件 ====================
package "读者界面组件" <<Rectangle>> {
    
    class 读者主页布局 <<组件>> {
        - 当前菜单: string
        + 处理菜单选择(索引): void
        + 处理登出(): void
        --
        功能：
        - 侧边栏导航
        - 顶部用户信息
        - 退出登录
    }
    
    class 首页视图 <<组件>> {
        - 读者信息: 读者 | null
        - 推荐图书: 出版物[]
        + 加载读者信息(): void
        + 加载推荐图书(): void
        + 处理借阅(图书): void
        + 处理预约(图书): void
        --
        功能：
        - 显示个人统计
        - 推荐图书展示
        - 快速借阅/预约
    }
    
    class 搜索视图 <<组件>> {
        - 图书列表: 出版物[]
        - 搜索表单: 搜索表单
        - 我的预约: 预约记录[]
        + 加载图书(): void
        + 处理搜索(): void
        + 处理借阅(图书): void
        + 处理预约(图书): void
        + 是否已预约(出版物ID): boolean
        --
        功能：
        - 搜索图书
        - 查看图书详情
        - 预约不可借图书
        - 防止重复预约
    }
    
    class 预约视图 <<组件>> {
        - 预约列表: 预约记录[]
        + 加载预约(): void
        + 处理取消(预约): void
        + 处理前往借阅(预约): void
        --
        功能：
        - 查看我的预约
        - 显示队列位置
        - 取消预约
        - 预约状态跟踪
    }
    
    class 登录视图 <<组件>> {
        - 当前标签: string
        - 登录表单: 登录表单
        + 处理登录(): void
        + 处理注册(): void
        --
        功能：
        - 读者/管理员登录
        - 角色验证
        - 防止错误登录
    }
    
    class 注册视图 <<组件>> {
        - 注册表单: 注册表单
        + 处理注册(): void
        --
        功能：
        - 读者注册
        - 表单验证
        - 自动设置初始值
    }
}

' ==================== 继承关系 ====================
用户 <|-- 读者 : 继承
用户 <|-- 管理员 : 继承
出版物 <|-- 书籍 : 继承
出版物 <|-- 期刊 : 继承
出版物 <|-- 电子书 : 继承

' ==================== 关联关系 ====================
读者 "1" -- "0..*" 借阅记录 : 借阅 >
读者 "1" -- "0..*" 预约记录 : 预约 >
读者 "1" -- "0..*" 罚款记录 : 产生 >

出版物 "1" -- "0..*" 借阅记录 : < 被借阅
出版物 "1" -- "0..*" 预约记录 : < 被预约

借阅记录 "1" -- "0..1" 罚款记录 : 产生 >

用户 "1" -- "0..*" 通知 : 接收 >

分类 "1" -- "0..*" 出版物 : 包含 >
分类 "0..1" -- "0..*" 分类 : 父子关系

' ==================== 依赖关系 ====================
认证服务 ..> 数据库服务 : 使用
认证服务 ..> 加密工具 : 使用
数据库服务 ..> 存储服务 : 使用

认证状态 ..> 认证服务 : 使用

管理员控制面板 ..> 数据库服务 : 使用
管理员控制面板 ..> 认证状态 : 使用

出版物管理 ..> 数据库服务 : 使用
出版物管理 ..> 加密工具 : 使用

读者管理 ..> 数据库服务 : 使用

借阅管理 ..> 数据库服务 : 使用
借阅管理 ..> 加密工具 : 使用

预约管理 ..> 数据库服务 : 使用
预约管理 ..> 加密工具 : 使用

读者主页布局 ..> 认证状态 : 使用

首页视图 ..> 数据库服务 : 使用
首页视图 ..> 认证状态 : 使用
首页视图 ..> 加密工具 : 使用

搜索视图 ..> 数据库服务 : 使用
搜索视图 ..> 认证状态 : 使用
搜索视图 ..> 加密工具 : 使用

预约视图 ..> 数据库服务 : 使用
预约视图 ..> 认证状态 : 使用

登录视图 ..> 认证状态 : 使用

注册视图 ..> 认证服务 : 使用

' ==================== 注释说明 ====================
note right of 数据库服务
  <b>核心数据访问层</b>
  - 封装 LocalStorage 操作
  - 提供统一的 CRUD 接口
  - 管理所有数据表
  - 支持数据导出/导入
end note

note right of 认证服务
  <b>认证与授权</b>
  - 用户登录/登出
  - 密码加密验证
  - JWT Token 管理
  - 角色权限控制
end note

note right of 认证状态
  <b>全局状态管理</b>
  - 使用 Pinia
  - 响应式用户状态
  - 跨组件共享
end note

note bottom of 借阅记录
  <b>自动化处理</b>
  - 自动检测逾期
  - 自动生成罚款
  - 自动更新信用分数
  - 自动更新库存
end note

note bottom of 预约记录
  <b>优先级队列</b>
  - 按优先级排序
  - 自动通知机制
  - 自动过期检测
  - 取消后通知下一位
end note

note bottom of 出版物
  <b>多态设计</b>
  - 书籍：30天借阅期
  - 期刊：7天借阅期
  - 电子书：无借阅期限
end note

legend right
  <b>图例说明</b>
  |<back:LightBlue>   </back>| 实体类 |
  |<back:LightGreen>   </back>| 服务类 |
  |<back:LightYellow>   </back>| 状态管理 |
  |<back:LightPink>   </back>| 视图组件 |
  
  <b>技术栈</b>
  - 前端：Vue 3 + TypeScript + Vite
  - UI：Element Plus + Tailwind CSS
  - 状态：Pinia
  - 路由：Vue Router
  - 存储：LocalStorage
  
  <b>特点</b>
  - 纯前端架构，无需后端
  - 数据持久化在浏览器
  - 零配置，即开即用
  - 支持数据导出/导入
endlegend

@enduml
